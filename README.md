# Проект "IT Course Landing"

Проект для создания и ведения лендинг-страниц, нацеленных на привлечение клиентов на курсы по программированию.

## Ключевые компоненты

### 1. Веб-страницы

*   `index.html`: Основной многостраничный сайт с подробной информацией о курсах и программе.
*   `landing.html`: Современная одностраничная лендинг-страница для быстрых рекламных кампаний.
*   `*.md`: Исходные файлы с контентом, который используется для наполнения HTML-страниц.

### 2. Система аналитики поведения пользователей

Для понимания эффективности страниц и поведения пользователей в проект встроена система сбора аналитики.

*   **Клиентский трекер (`src/ui/tracker.ts`):** Легковесный JavaScript/TypeScript-модуль, который встраивается в страницы и отслеживает ключевые метрики:
    *   Время нахождения на странице.
    *   Глубина прокрутки.
    *   Ключевые действия (клики по кнопкам, переходы).
    *   Время просмотра отдельных секций страницы.
*   **Форма обратной связи (`src/ui/form.html`):** Отдельная HTML-форма для сбора заявок с расширенной валидацией.
*   **Бэкенд (`src/api/server.ts`):** Кастомный сервер на `Bun.serve`, который принимает данные от трекера и формы, обрабатывает их и сохраняет напрямую в базу данных.
*   **Хранилище данных (SQLite):** Все собранные метрики и данные форм сохраняются в локальную базу данных SQLite (`course.sqlite`).

## Быстрый старт

1.  **Установка зависимостей:**
    ```bash
    bun install
    ```

2.  **Запуск сервера и сборка фронтенда (режим разработки):**
    ```bash
    bun run start:dev
    ```
    *   Эта команда соберет фронтенд-файлы в `dist/dev` и запустит бэкенд-сервер на порту 3000.

3.  **Просмотр страниц:**
    *   Откройте `http://localhost:3000` в вашем браузере.

4.  **Запуск тестов:**
    *   **Юнит-тесты:**
        ```bash
        bun test src/domain/phone.test.ts # Пример запуска конкретного теста
        bun test # Запустить все тесты
        ```
    *   *(Интеграционные и E2E тесты будут добавлены позже)*

## Технологический стек

*   **Frontend:** HTML5, CSS3, TypeScript (сборка через Bun)
*   **Backend:** Bun.serve, TypeScript
*   **База данных:** SQLite (через `bun:sqlite`)
*   **Система миграций:** Для управления схемой базы данных используются скрипты миграций, расположенные в директории `migrations/`. Правила и соглашения по работе с БД описаны в `migrations/db_rules.md`.
*   **Среда выполнения и пакетный менеджер:** Bun
*   **n8n:** для работы ИИ-агента, но выбор сделан в рекламных целях. Обещание что они могут делать такие же фичи без программирования.

## Стратегия тестирования

Для обеспечения стабильности и качества проекта используется многоуровневая стратегия тестирования:

*   **Юнит-тесты:** Проверяют мельчайшие, изолированные части кода (функции, методы классов). Фокус на критически важных функциях (например, валидация телефонных номеров, методы репозиториев).
*   **Интеграционные тесты:** Проверяют взаимодействие между несколькими модулями или слоями (например, API-эндпоинт -> сервис -> репозиторий -> БД).
*   **Сквозные (E2E) тесты:** Имитируют полный пользовательский путь в браузере.

**Баланс тестирования:** Мы стремимся к тому, чтобы тесты обеспечивали работоспособность важнейших узлов и частей проекта, не пытаясь покрыть каждую строку кода. Основное внимание уделяется критическим функциям и потенциальным точкам отказа.

## Работа с базой данных

### Структура базы данных

Проект использует SQLite с системой миграций для управления схемой БД:

- **Основные таблицы:**
  - `form_submissions` - отправленные формы заявок
  - `user_events` - события аналитики пользователей
  - `_migrations` - служебная таблица для отслеживания выполненных миграций

### Утилиты для работы с БД

Для многих утилит предусмотрена справка, пример: `bun db-utils/run-migrations.ts --help`

#### Запуск миграций

Безопасная последовательность команд для применения миграций без потери данных:

1. Сначала проверь текущее состояние
```bash
# Проверить состояние базы данных
bun run db-utils/check-db.ts

# Посмотреть статус миграций
bun run db-utils/run-migrations.ts --status
```

2. Сделай резервную копию (ОБЯЗАТЕЛЬНО!)
```bash
# Создать резервную копию базы данных
bun run db:backup

# Проверить что бэкап создался
ls -la db-backups/course*
```

3. Проверь существующие данные
```bash
# Посмотреть текущие заявки (убедись что данные на месте)
bun run db-utils/view-submissions.ts --limit=5

# Посмотреть текущие события
bun run db-utils/view-events.ts --limit=5
```

4. Запусти миграции
```bash
bun run db-utils/run-migrations.ts --force
```

5. Проверь что миграции применились
```bash
# Проверить статус миграций после применения
bun run db-utils/run-migrations.ts --status

# Убедиться что данные не потерялись
bun run db-utils/view-submissions.ts --limit=5
bun run db-utils/view-events.ts --limit=5

# Проверить структуру базы
bun run db-utils/check-db.ts
```

### Правила работы с БД
- Миграции должны быть идемпотентными - безопасными для многократного выполнения
- Все изменения схемы БД выполняются только через миграции
- Перед деплоем в production всегда проверяйте статус миграций
- Резервное копирование - делайте бэкап БД перед выполнением миграций на проде

### Production рекомендации
- Всегда используйте --force флаг для миграций в production
- Проверяйте миграции на staging окружении перед продом
- Храните бэкапы БД в автоматическом режиме
- Мониторьте размер БД и производительность запросов
