# План реализации: Отслеживание времени просмотра секций

**Задача:** Реализовать механизм для отслеживания времени, которое пользователь проводит, просматривая определенные секции на странице, чтобы лучше понимать его интерес.

**Статусы:**
*   `[ ]` - Не начато
*   `[~]` - В процессе
*   `[x]` - Выполнено

---

### **Этап 1: Модификация HTML (`index.html`)**

*   `[x]` **1.1. Добавить атрибут `data-track-view-time` к отслеживаемым секциям.**
    *   **Действие:** Пройти по файлу `index.html` и добавить атрибут `data-track-view-time="<имя-секции>"` ко всем логическим блокам, время просмотра которых мы хотим измерять. Имя секции должно быть уникальным (например, `about-courses-intro`, `how-we-learn`, `reviews-azat`).

---

### **Этап 2: Модификация Frontend (`tracker.js`)**

*   `[ ]` **2.1. Реализовать сбор данных о времени просмотра.**
    *   **Действие:** В `tracker.js` написать логику, которая:
        1. Находит все элементы с атрибутом `data-track-view-time`.
        2. Использует `IntersectionObserver` для отслеживания их появления и исчезновения из видимой области.
        3. Запускает и останавливает таймеры, накапливая время просмотра для каждого элемента в объекте.
*   `[x]` **2.2. Интегрировать новые данные в отправляемый payload.**
    *   **Действие:** Модифицировать функцию `sendData` (или место, где формируется итоговый объект `analyticsState`), чтобы добавить в него собранные данные о времени просмотра секций.

---

### **Этап 3: Модификация Backend (База данных и n8n)**

*   `[x]` **3.1. Подготовить базу данных.**
    *   **Действие:** Добавить колонку `section_view_times` (тип `TEXT`) в таблицу `user_events`. (Уже выполнено).
*   `[x]` **3.2. Обновить код в n8n-ноде.**
    *   **Действие:** Изменить код в файле `gemini_output.txt`, чтобы он корректно принимал новое поле `sectionViewTimes` и записывал его в колонку `section_view_times`.

---

### **Этап 4: Тестирование**

*   `[x]` **4.1. Проверить сквозной процесс.**
    *   **Действие:** Убедиться, что после сессии на сайте в базе данных появляются записи с корректно заполненным полем `section_view_times` в формате JSON.
