# Пилотный проект по освоению пакета n8n

Задача: освоить на реальном примере пакет n8n.

## Как n8n может помочь в этом проекте?
Задача проекта написана в AGENTS.md, это привлечение клиентов на курсы программирования.

Высокоуровневая задача: начать логировать поведение людей которые попали на страничку.
1. Для каждого потенциального клиента, создается уникальный id;
1. Запоминается поведение клиента:
    1. для landing.html:
        1. сколько он пробыл на страничке;
        1. насколько он проскроллил в %;
        1. что он сделал в конце (закрыл, нажал "Заполнить анкету" или "Узнать больше")
    1. для index.html:
        1. какие вкладки он открывал;
        1. насколько быстро и вдумчива читал (наверно через скорость скроллинга);
        1. сколько в % проскроллил;
        1. какой путь проходил (история открытия вкладок);
        1. что сделал в конце (заполнил анкету, перешел по ссылке (куда?), закрыл (на какой вкладке и каком месте?))
1. отправляется на сервер.

## Ответы и план реализации

### Может ли n8n хранить данные?

Короткий ответ: **нет, n8n не предназначен для хранения данных.**

**n8n** — это инструмент для **автоматизации рабочих процессов**. Его задача — получать данные из одного места (в нашем случае, с веб-страницы через вебхук), обрабатывать их и **отправлять в другое место**.

**Наше новое решение:** Мы будем использовать **локальную базу данных SQLite** (`analytics.sqlite`). Наш workflow в n8n будет принимать данные с сайта и записывать их в этот файл.

---

### План реализации

**Статусы:**
*   `[ ]` - Не начато
*   `[~]` - В процессе
*   `[x]` - Выполнено

---

### **Этап 1: Настройка Backend и хранилища**

*   `[x]` **1.1. Создание базы данных и таблицы.**
    *   **Действие:** Создать файл `analytics.sqlite` и выполнить в нем SQL-запрос для создания таблицы `events`.
*   `[~]` **1.2. Создание n8n workflow.**
    *   **Действие:** Вместо ноды `Airtable` использовать ноду `SQLite` для подключения к файлу `analytics.sqlite` и добавления записей в таблицу `events`.

---

### **Этап 2: Разработка JS-трекера (`tracker.js`)**

*   `[x]` **2.1. Создание файла `tracker.js` и базовой структуры.**
*   `[x]` **2.2. Реализация уникального ID клиента.**
*   `[x]` **2.3. Реализация базовых метрик (общих для всех страниц).**
*   `[x]` **2.4. Реализация идентификации страницы.**
*   `[x]` **2.5. Реализация отправки данных (`sendData`).**
    *   `[x]` Заменить placeholder на реальный URL вебхука из n8n.
*   `[x]` **2.6. Реализация специфичных метрик для `index.html`.**

---

### **Этап 3: Интеграция и тестирование**

*   `[x]` **3.1. Интеграция трекера с HTML.**
*   `[x]` **3.2. Сквозное тестирование.**
    *   `[x]` Проверить отправку базовых метрик с `landing.html`.
    *   `[x]` Проверить отправку специфичных метрик с `index.html`.
        *   `[x]` Проверить отслеживание пути навигации по вкладкам (`navigationPath`).
    *   `[x]` Убедиться, что все данные корректно записываются в `analytics.sqlite`.
